# Session 5 - 2026-01-09

## Comparison UI Fixes - Brainstorming & Planning Complete

### Context
Post-processing feature implemented, but has bugs:
- Sync scroll doesn't align by timestamps
- Download buttons missing in comparison mode
- No view switching (Cleaned/Original/Comparison)
- LLM timestamps unstable (may return wrong format)

### Decisions Made

1. **View modes**: Tabs `[Cleaned] [Original] [Comparison]`, default to Cleaned
2. **Sync scroll**: Timestamp-based (find nearest), not percentage-based
3. **Download buttons**: Grouped by format `TXT [copy][download] JSON [copy][download]`
4. **Raw API button**: Only for cloud engines, also with copy+download
5. **LLM JSON mode**: Already enabled (Gemini/OpenRouter), improve prompt
6. **Speaker sync**: Update both transcript.json and transcript_cleaned.json
7. **New endpoints**: `/download/cleaned/txt`, `/download/cleaned/json`
8. **Prompt improvement**: Stronger timestamp rules, self-check, examples in seconds

### Implementation Plan (10 tasks)

| Task | Description |
|------|-------------|
| 0 | Improve LLM prompt for timestamps (all 3 templates) |
| 1 | Add cleaned download endpoints |
| 2 | Update speaker sync |
| 3 | Update original download filenames |
| 4 | Add API helper functions |
| 5 | Create TranscriptPanel component |
| 6 | Refactor TranscriptComparison |
| 7 | Refactor page with tabs |
| 8 | Fix unused import |
| 9 | Manual testing |

### Files Created
- `docs/backlog/05-comparison-ui-fixes/design.md`
- `docs/backlog/05-comparison-ui-fixes/plan.md`

### Result
Design and plan complete, ready for execution.

---

## Feature 06: Speaker Name Suggestions - Brainstorming Complete

### Context
LLM автоматически определяет имена и роли спикеров из контекста разговора во время post-processing.

### Decisions Made

1. **Когда:** Во время post-processing (тот же вызов LLM)
2. **Что определяем:** Имя + Роль с confidence и reason для каждого
3. **Формат отображения:** "Лена (дизайнер)" или только имя/роль
4. **Хранение:** Отдельный файл `speaker_suggestions.json`
5. **UI:** Hint рядом с полем, цвет по confidence (зелёный/жёлтый/серый)
6. **Кнопки:** Apply у каждого + Apply All
7. **После Apply:** `applied: true`, suggestion скрывается
8. **Темплейты:** Разные role_context для IT Meeting / Interview / Business Call

### Files Created
- `docs/backlog/06-speaker-name-suggestions/design.md`
- `docs/backlog/06-speaker-name-suggestions/plan.md`

### Implementation Plan (7 tasks)

| Task | Description |
|------|-------------|
| 0 | Update BASELINE_PROMPT with speaker identification |
| 1 | Parse and save speaker suggestions |
| 2 | Add suggestions API endpoints |
| 3 | Add types and API functions |
| 4 | Update SpeakerEditor with suggestions UI |
| 5 | Refresh suggestions after post-processing |
| 6 | Manual testing |

### Result
Design and plan complete, ready for execution.
